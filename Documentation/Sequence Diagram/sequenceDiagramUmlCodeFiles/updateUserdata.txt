@startuml
title Update User Profile

actor User
participant "editProfile.html" as Frontend
participant "userController" as Controller
participant "userService" as Service
participant "userDAO" as DAO
participant "Database" as DB

User -> Frontend : Edit profile form\n{username, password, role, email}
Frontend -> Controller : PUT /user/profile/{userId}\nusername, password, role, email
Controller -> Service : updateUserProfile(userId, username, password, role, email)
Service -> DAO : updateUser(userId, encryptedPassword, username, role, email)

alt User Exists and Update Successful
    DAO -> DB : SELECT * FROM Users WHERE userId = ?
    DB --> DAO : User found
    DAO -> DB : UPDATE Users SET\nusername=?, password=?, role=?, email=?\nWHERE userId=?
    DB --> DAO : Update success
    DAO --> Service : true
    Service --> Controller : true
    Controller --> Frontend : 200 OK\n"Profile updated successfully"
    Frontend -> User : Show success message

else User Not Found
    DAO -> DB : SELECT * FROM Users WHERE userId = ?
    DB --> DAO : No match
    DAO --> Service : error: user not found
    Service --> Controller : error: user not found
    Controller --> Frontend : 404 Not Found\n"User does not exist"
    Frontend --> User : Show error message

else Server Error
    DAO -> DB : UPDATE Users
    DB --> DAO : DB error
    DAO --> Service : error: server issue
    Service --> Controller : error: server issue
    Controller --> Frontend : 500 Internal Server Error\n"Update failed"
    Frontend --> User : Show error message

end
@enduml
