<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Shopping Cart</title>
    <link rel="stylesheet" th:href="@{/styles/index.css}">
    <link rel="stylesheet" th:href="@{/styles/cart.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
</head>
<body>
<div class="container-fluid outer-container">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container my-5 custom-container">
        <h2 class="text-center mb-4" style="font-weight:700; letter-spacing:1px;">Shopping Cart</h2>

        <div th:if="${cartMessage}" class="alert alert-info text-center" style="margin-bottom: 1em;">
            <span th:text="${cartMessage}"></span>
        </div>

        <div th:if="${#lists.isEmpty(cartItems)}" class="text-center py-5">
            <h3>Your cart is empty.</h3>
            <a th:href="@{/}" class="btn btn-primary mt-3">Continue Shopping</a>
        </div>

        <div class="row" th:if="${not #lists.isEmpty(cartItems)}">
            <div class="col-lg-8 mb-4 mb-lg-0">
                <div th:each="item : ${cartItems}" class="card mb-3">
                    <div class="row g-0 align-items-center cart-item">
                        <div class="col-md-3">
                            <img th:src="@{${item.product.imageUrl}}" class="img-fluid rounded" alt="Product Image" style="max-height:150px; object-fit:cover; padding: 10px;" />
                        </div>
                        <div class="col-md-6">
                            <div class="card-body">
                                <h5 class="card-title mb-2" th:text="${item.product.name}">Product Name</h5>
                                <div class="d-flex justify-content-between">
                                    <span th:text="'Unit: ₹' + ${#numbers.formatDecimal(item.product.price, 1, 2)}">Unit: ₹99.99</span>
                                </div>
                                <div class="delivery-info mt-2">
                                    <i class="fas fa-truck"></i>
                                    <span>Estimated Delivery: <strong>3-5 days</strong></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="d-flex flex-column align-items-center justify-content-center h-100 p-3">
                                <form method="post" class="quantity-controls">
                                    <input type="hidden" name="cartId" th:value="${item.cartId}" />
                                    <button type="submit" th:formaction="@{/cart/update}" name="quantity" th:value="${item.quantity - 1}" class="btn btn-sm btn-outline-secondary quantity-btn">-</button>
                                    <span class="quantity-display" th:text="${item.quantity}">1</span>
                                    <button type="submit" th:formaction="@{/cart/update}" name="quantity" th:value="${item.quantity + 1}" class="btn btn-sm btn-outline-secondary quantity-btn">+</button>
                                </form>
                                <form th:action="@{/cart/remove}" method="post">
                                    <input type="hidden" name="cartId" th:value="${item.cartId}" />
                                    <button type="submit" class="btn btn-link text-danger remove-btn">
                                        <i class="fas fa-trash-alt me-1"></i>Remove
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card summary-card sticky-lg-top">
                    <div class="card-body">
                        <h5 class="card-title text-center mb-4">Summary</h5>
                        <div th:each="item : ${cartItems}" class="d-flex justify-content-between mb-2">
                            <span>
                                <span th:text="${item.product.name}"></span>
                                <span class="text-muted" th:text="' x' + ${item.quantity}"></span>
                            </span>
                            <span th:text="'₹' + ${#numbers.formatDecimal(item.product.price * item.quantity, 1, 2)}"></span>
                        </div>
                        <hr>
                        <h5 class="d-flex justify-content-between">Total: <span th:text="'₹' + ${#numbers.formatDecimal(subtotal, 1, 2)}">₹999.99</span></h5>
                        <a th:href="@{/checkout}" class="btn btn-primary w-100 mt-3 py-2" style="font-size:1.1rem; font-weight:600;">Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
